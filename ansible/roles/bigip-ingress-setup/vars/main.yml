---
# vars file for bigip-ingress-setup

####icall_script####
icall_definition: "set nodelist \"\"\n        set nodecounter 0\n        tmsh::modify cli global-settings service number\n        #tmsh::log \"iCall: Starting to enumerate existing vs objects...\"\n        foreach partition [tmsh::get_config auth partition] {\n          set partition \"/[tmsh::get_name $partition]\"\n          #tmsh::log \"iCall: Processing Partition: $partition\"\n          tmsh::cd $partition\n          set vs [tmsh::get_config ltm virtual recursive]\n          #tmsh::log \"$vs\"\n          foreach v $vs {\n              set v_name [tmsh::get_name $v]\n              #tmsh::log \"Processing VS : $partition/$v_name\"\n              set v_attrs [tmsh::get_status ltm virtual $v_name]\n              foreach a $v_attrs {\n                  set dest [tmsh::get_field_value $a \"destination\"]\n                  #tmsh::log \"Destination : $dest\"\n                  append nodelist \"\\\"$dest\\\" \\{ data \\\"$partition/$v_name\\\" \\}\\n\"\n              }\n              incr nodecounter\n          }\n          #tmsh::log \"Finished Partition: $partition\"\n        }\n        tmsh::cd \"/Common\"\n        if { not ([tmsh::list /ltm data-group] contains \"ltm data-group internal DG_IP_2_VS\") } then {\n            tmsh::log \"iCall: Created the data-group \\\"DG_IP_2_VS\\\".\"\n            tmsh::create /ltm data-group internal \"DG_IP_2_VS\" type \"string\"\n        } else {\n            #tmsh::log \"iCall: The DataGroup does exist.\"\n        }\n        tmsh::log \"nodelist: $nodelist\"\n        if { $nodecounter > 0 } then {\n            eval \"tmsh::modify /ltm data-group internal DG_IP_2_VS \\{ records replace-all-with \\{ $nodelist \\} \\}\"\n        }\n        tmsh::log \"iCall: Updated the data-group DG_IP_2_VS with \\\"$nodecounter\\\" entries.\"\n"
